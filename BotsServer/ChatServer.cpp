#include "ChatServer.h"

ChatServer::ChatServer(boost::asio::io_service& io_service, const tcp::endpoint& endpoint) : acceptor_(io_service, endpoint), socket_(io_service)
{
	do_accept();
}

void ChatServer::send_order(Message& msg)
{
	room_.deliver(msg);
}

void ChatServer::do_accept()
{
	acceptor_.async_accept(socket_,
		[this](boost::system::error_code ec)
		{
			if (!ec)
			{
				std::make_shared<ChatSession>(std::move(socket_), room_)->start();
			}

			do_accept();
		});
}
